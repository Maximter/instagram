<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <title>@{{owner.username}}</title>
    <link rel="stylesheet" type="text/css" href="./../css/profile-page.css"/>
    <link rel="shortcut icon" type="image/x-icon" href="./../img/system/title-logo.png" />
  </head>
  <body>
    <header>
      <section>
        <a href="/"><p class="logo-name">Instyle</p></a>
        <div class="header-icons">
          <a href="/"><img src="./../img/system/home-empty.svg" alt="Главная страница" title="Главная страница"></a>
          <a href="/chat"><img src="./../img/system/chat-empty.svg" alt="Мессенджер" title="Мессенджер"></a>
          <a href="/post"><img src="./../img/system/add-empty.svg" alt="Добавить фотографию" title="Добавить фотографию"></a>
          <a href="/recommendation"><img src="./../img/system/compass-empty.svg" alt="Рекомендуемое" title="Рекомендуемое"></a>
          <a href="/notification"><img src="./../img/system/notification-empty.svg" alt="Уведомления" title="Уведомления"></a>
          <a href="/user/{{user.username}}"><img src="./../img/avatar/{{#if user.avatar}}{{user.id}}{{else}}standard{{/if}}.jpg" alt="{{user.name_lastname}}" title="{{user.name_lastname}}" class="user-avatar" {{#if user.owner}}{{else}}style="border: none;"{{/if}}></a>
        </div>
      </section>
    </header>

    <section class="profile-section">
      <div class="avatar-main-block">
        <img src="./../img/avatar/{{#if owner.avatar}}{{owner.id}}{{else}}standard{{/if}}.jpg" alt="{{owner.name_lastname}}" title="{{owner.name_lastname}}" class="user-avatar-main">
        <div {{#if owner.onlineBool}}class="onlinePoint"{{/if}}></div>
      </div>
      <div class="info-block">
        <div class="username-block"> 
          <p class="user-username">{{owner.username}}</p>
          {{#if user.owner}}
            <button class="settings-button" onclick="window.location='/settings'">Настройки</button>
          {{else}}
          <button class="follow-button" onclick="window.location='/chat/{{owner.username}}'">Написать сообщение</button>
          <form action="/follow/{{owner.username}}" method="post">
            {{#if user.follow}}
            <button class="unfollow-button">Отписаться</button>
            {{else}}
            <button class="follow-button">Подписаться</button>
            {{/if}}
          </form>
          {{/if}}
         
        </div>
       
       <div class="numbers-block">
        <p>публикаций : {{owner.countPost}}</p>
        <p class="click" id="get_followers">подписчиков : {{owner.countFollowers}}</p>
        <p class="click" id="get_followings">подписок : {{owner.countFollowings}}</p>
       </div>
       <div class="bio-block">
        <p>{{owner.name_lastname}}</p>
        <p>{{owner.bio}}</p>
     
       </div>
      </div>
      
    </section>

    <section class="main-section" id="main-section">
      <ul>
         {{#each post}}
          <li>
            <a href="/post/{{this.id_img}}">
                {{#if this.gif}}
                <img src="/img/postedPic/{{this.id_img}}.gif" class="post-pic" title="{{this.comment}}">
                {{else}}
                <img src="/img/smallPostedPic/{{this.id_img}}.jpg" class="post-pic" title="{{this.comment}}">
                {{/if}}
            </a>
          </li>
         {{/each}}
      </ul>
    </section>


<script src="/socket.io/socket.io.js"></script>
  <script src="../js/sockets.js"></script>
  <script src="../js/sweetalert2.all.min.js"></script>
  <script>
    const get_followers = document.getElementById('get_followers')
    const get_followings = document.getElementById('get_followings')

    const followers_info = [];
    const followings_info = [];
    {{#each owner.followers}}
      followers_info.push(['{{this.follower.username}}', '{{this.follower.avatar}}', Number('{{this.follower.id}}')])
      if (followers_info[followers_info.length-1][1] == 'true') followers_info[followers_info.length-1][3] = followers_info[followers_info.length-1][2];
      else followers_info[followers_info.length-1][3] = 'standard';
    {{/each}}

    {{#each owner.followings}}
      followings_info.push(['{{this.following.username}}', '{{this.following.avatar}}', Number('{{this.following.id}}')])
      if (followings_info[followings_info.length-1][1] == 'true') followings_info[followings_info.length-1][3] = followings_info[followings_info.length-1][2];
      else followings_info[followings_info.length-1][3] = 'standard';
    {{/each}}

    

    get_followers.onclick = () => {
      let htmlText = '<ul style="background: #fff">';
      for (let i = 0; i < followers_info.length; i++) {
        htmlText += `<a href="/user/${followers_info[i][0]}" style="display: flex; background: #fff;">
                    <li style="display: flex; height: 70px; padding: 7px; background: #fff; border-radius: 5px">
                      <img src="./../img/avatar/${followers_info[i][3]}.jpg" style="width: 50px; height: 50px; object-fit: cover; border-radius: 50%;">
                      <p style="margin-left: 20px; background: #fff">${followers_info[i][0]}</p>
                    </li>
                    </a>
                    </ul>`      
      }

      Swal.fire({
        title: 'Подписчики',
        html:htmlText,
        showCloseButton: true,
        showConfirmButton: false,
      })
    }


    get_followings.onclick = () => {
      console.log(followings_info)
     let htmlText = '<ul style="background: #fff">';
      for (let i = 0; i < followings_info.length; i++) {
        htmlText += `<a href="/user/${followings_info[i][0]}" style="display: flex; background: #fff;">
                    <li style="display: flex; height: 70px; padding: 7px; background: #fff; border-radius: 5px">
                      <img src="./../img/avatar/${followings_info[i][3]}.jpg" style="width: 50px; height: 50px; object-fit: cover; border-radius: 50%;">
                      <p style="margin-left: 20px; background: #fff">${followings_info[i][0]}</p>
                    </li>
                    </a>
                    </ul>`      
      }

      Swal.fire({
        title: 'Подписки',
        html:htmlText,
        showCloseButton: true,
        showConfirmButton: false,
      })
    }
  </script>
  </body>
</html>