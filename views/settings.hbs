<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <title>Instyle</title>
    <link rel="stylesheet" type="text/css" href="../css/settings.css"/>
    <link rel="shortcut icon" type="image/x-icon" href="../img/system/title-logo.png" />
  </head>
  <body>
    <header>
      <section>
        <a href="/"><p class="logo-name">Instyle</p></a>
        <div class="header-icons">
          <a href="/"><img src="../img/system/home-empty.svg" alt="Главная страница" title="Главная страница"></a>
          <a href="/chat"><img src="../img/system/chat-empty.svg" alt="Мессенджер" title="Мессенджер"></a>
          <a href="/post"><img src="../img/system/add-empty.svg" alt="Добавить фотографию" title="Добавить фотографию"></a>
          <a href="/find"><img src="../img/system/compass-empty.svg" alt="Найти людей" title="Найти людей"></a>
          <a href="/notification"><img src="../img/system/notification-empty.svg" alt="Уведомления" title="Уведомления"></a>
          <a href="/user/{{user.username}}"><img src="../img/avatar/{{#if user.avatar}}{{user.id}}{{else}}standard{{/if}}.jpg" alt="{{user.name_lastname}}" title="{{user.name_lastname}}" class="user-avatar"></a>
        </div>
      </section>
    </header>
    
    
    <section class="main-section">
      <h1>Настройки</h1>

      <div class="settings-block">
        <form action="/settings/change-avatar" enctype="multipart/form-data" method="post">
          
          <div class="name-section">
            <h3>Изменить аватар</h3>
          </div>
          
         <img src="../img/avatar/{{#if user.avatar}}{{user.id}}{{else}}standard{{/if}}.jpg" alt="{{user.name_lastname}}" title="{{user.name_lastname}}" class="user-big-avatar" id="settings-avatar">
          
          <p class="paste-photo-text">Выберете фотографию с устройства</p>
          <input type="file" class="input__file" name="avatar" id="input_file" accept=".jpeg,.jpg">
          <label for="input_file" class="input__file-button">
              <span class="input__file-button-text">Выбрать фотографию</span>
          </label>

          <div class="block-change">

          <button>Изменить</button>
        </form>


        <form action="/settings/edit-profile" method="post">
          
          <div class="name-section">
            <img src="../img/system/edit.svg" alt="Профиль" title="Профиль" class="name-section-img">
            <h3>Редактировать профиль</h3>
          </div>
          
          <div class="block-change">
              <h5>Ваше имя</h5>
              <input type="text" value="{{user.name_lastname}}" name="name_lastname" required>
          </div>

          <div class="block-change">
            <h5>Ваше имя пользователя</h5>
            <input type="text" value="{{user.username}}" name="username" required>
          </div>

          <div class="block-change">
            <h5>О себе</h5>
            <textarea name="bio">{{#if bio}} {{bio}} {{else}} {{user.bio}} {{/if}}</textarea>
          </div>

           <div class="block-change">
            <h5>Ваш эл. адрес</h5>
            <input type="text" value="{{user.email}}" name="email" required>
          </div>

          <button>Изменить</button>
        </form>


        <form action="/settings/change-password" method="post">
          
          <div class="name-section">
            <img src="../img/system/lock.svg" alt="Профиль" title="Профиль" class="name-section-img">
            <h3>Сменить пароль</h3>
          </div>
          
          <div class="block-change">
              <h5>Старый пароль</h5>
              <input type="password" name="old-pass" required>
          </div>

          <div class="block-change">
            <h5>Новый пароль</h5>
              <input type="password" name="new-pass" required>
          </div>

          <div class="block-change">
            <h5>Подтвердите новый пароль</h5>
              <input type="password" name="new-pass2" required>
          </div>

          <button class="last-element">Изменить</button>
        </form>
      
      </div>
    </section>

  <script src="../js/sweetalert2.all.min.js"></script>
  <script>
    const input_image = document.getElementById('input_file');
  const settings_avatar = document.getElementById('settings-avatar');

  input_image.onchange = () => {
    const [file] = input_image.files
    if (file) settings_avatar.src = URL.createObjectURL(file)
  }
  </script>

  {{#if err}}
    <script>
      Swal.fire({
        title: 'Ошибка!',
        text: '{{err}}',
        icon: 'error',
        confirmButtonText: 'Повторить попытку'
      })
    </script>
{{/if}}

{{#if success}}
    <script>
     Swal.fire({
        title: 'Настройки',
        text: '{{success}}',
        icon: 'success',
        confirmButtonText: 'Продолжить'
      }){{#if warn}}.then((result) => {
        if (result.isConfirmed) {
          Swal.fire({
            title: 'Смена почты',
            text: '{{warn}}',
            icon: 'warning',
            confirmButtonText: 'Продолжить'
          })
        }
      })
      {{/if}}
      {{#if toLogin}}.then((result) => {
        if (result.isConfirmed) {
          window.location.href = '/login';
        }
      })
      {{/if}}
    </script>
{{/if}}
  </body>
</html>